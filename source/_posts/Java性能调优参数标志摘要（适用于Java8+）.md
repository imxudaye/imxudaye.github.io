---
title: Java性能调优参数标志摘要（适用于Java8+)
date: 2021-12-09 18:27:56
categories:
- 后端
tags:
- 垃圾收集器
- JVM参数
---

### Java性能调优参数标志摘要（适用于Java8+）

#### 调优JIT编译器参数标志

|            参数标志            |                        功能                        |                           使用场景                           |      |
| :----------------------------: | :------------------------------------------------: | :----------------------------------------------------------: | :--: |
|            -server             |                选择使用server编译器                |           适用于长时间运行，且同时要求高性能的应用           |      |
|            -client             |                选择使用client编译器                |                   适用于需要快速启动的应用                   |      |
|     -XX:+TieredCompilation     | 使用tiered编译（同时选择client和server标志的特性） | 适用于希望取得最佳性能，同时又有足够的内存可以支撑额外的编译代码的应用 |      |
| -XX:ReservedCodeCacheSize=<MB> |        设定JIT编译器进行代码编译的保留空间         | 当你遭遇警示消息“你的代码缓存已用尽”时，可以使用这个标志，通常结合Tiered编译标志一起使用 |      |
| -XX:InitialCodeCacheSize=<MB>  |        用于替JIT编译器编译代码分配初始空间         | 如果你需要为代码缓存预分配内存，可以使用该标志，不过这种情况不常发生 |      |
|    -XX:CompileThreshold=<N>    |    设置一段代码或循环执行多少次之后转而进行编译    | 使用server编译器时，调整这个标志可以让更多的方法变为编译执行，让编译更早地发生。如果你使用的不是Tiered编译，第一种情况有时就是一种优势。 |      |
|     -XX:+PrintCompilation      |          在日志中输出JIT编译器进行的操作           | 如果你怀疑某个重要的方法没有进行编译，或者对编译器的工作流程感到好奇，都可以使用这个标志进行查看 |      |
|    -XX:+CICompilerCount=<N>    |             设置JIT编译器使用的线程数              | 使用Tiered编译标志时，如果有太多的编译线程启动（尤其是在运行了多个JVM的大型机上），通过该标志可以调节JIT线程的数目 |      |

#### 选择GC算法的参数标志



|        参数标志         |                             功能                             |                           使用场景                           |       备注       |
| :---------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :--------------: |
|    -XX:+UseSerialGC     |               选择使用简单的单线程垃圾收集算法               |                     适用于堆容量小于100m                     | Serial垃圾收集器 |
|  -XX:+UseParallelOldGC  |            应用线程停顿时采用多线程进行老年代回收            | 如果你的应用能够容忍偶尔发生的长时间停顿，而你又希望用最小的CPU消耗取得最大的吞吐量，可以考虑使用这个标志 | Throughput收集器 |
|   -XX:+UseParallelGC    |          应用线程停顿时采用多线程进行新生代空间回收          |                 与UseParallelGC标志结合使用                  | Throughput收集器 |
| -XX:+UseConcMarkSweepGC |          使用后台多个线程以最低的停顿时间回收老年代          | 如果你有充足的CPU资源可以运行后台线程，你的堆也相对较小，并且你不希望垃圾收集的停顿时间过长，就可以使用该标志 |    CMS收集器     |
|    -XX:+UseParNewGC     |           应用线程停顿时采用多个线程回收新生代空间           |                与ConcMarkSweepGC标志结合使用                 |    CMS收集器     |
|      -XX:+UseG1GC       | 应用线程停顿时，使用多个线程回收新生代空间，使用后台线程回收老年代空间，以最大程度减小停顿 | 你有足够的CPU资源可以运行后台线程，你的堆也比较大，同时你又不希望有长时间的停顿，可以考虑使用该标志 |     G1收集器     |



#### 适用于所有GC算法的通用标志

|              标志              |                             功能                             |                           使用场景                           | 备注 |
| :----------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :--: |
|              -Xms              |                         堆的初始大小                         |           如果堆的默认值小于要求，可使用此标志调整           |      |
|              -Xmx              |                          堆的最大值                          | 如果默认的堆大小对你的应用而言过小（或者过大），可以利用该标志调整 |      |
|          -XX:NewRatio          |                   新生代与老年代之间的比率                   | 增大这个值会降低分配给新生代空间的堆的比例；减小这个值可以增大分配给新生代的堆的比率。这个设置只是一个初始值；除非自适应调整被关闭了，否则这个比率会随着垃圾收集发生变化（CMS收集器是个例外，使用CMS时新生代的大小保持恒定）。随着新生代空间的减小，新生代垃圾收集的频率会增加，Full GC的频率会降低（反之亦然） |      |
|          -XX:NewSize           |                       新生代的初始大小                       |                              \                               |      |
|         -XX:MaxNewSize         |                        新生代的最大值                        |                              \                               |      |
|              -Xmn              |                  等同于NewSize + MaxNewSize                  |                  看实际情况，如有需求可调整                  |      |
|      -XX:MetaspaceSize=N       |                        元空间的初始值                        |  如果你的应用使用了大量的类，你可能需要适当调整，增大默认值  |      |
|     -XX:MaxMetaspaceSize=N     |                        元空间的最大值                        |           减小这个值可以限制类的元数据占用空间大小           |      |
|    -XX:ParallelGCThreads=N     |                    垃圾收集器使用的线程数                    | 如果系统上同时运行了多个JVM，可以适当减小该参数值。如果JVM使用的堆非常大，又运行在一个处理能力很强的机器上，就应该适当增大这个参数值 |      |
|          -verbose:gc           |                     开启基本的GC日志功能                     |                              \                               |      |
|         -Xloggc:<path>         |                       GC日志输出到文件                       |                  日志落地到文件便于追踪分析                  |      |
|          -XX:+PrintGC          |                       开启GC的基本日志                       |                              \                               |      |
|      -XX:+PrintGCDetails       |                          GC详细日志                          | 即使是在生产环境中，也应尽量开启该标志（GC日志的开销几乎可以忽略） |      |
|     -XX:+PrintGCTimeStamps     |                         GC日志时间戳                         |                                                              |      |
|     -XX:+PrintGCDateStamps     |                       GC日志日期时间戳                       |   相对于时间戳方式，这种方式的开销更大，不过可能更容易处理   |      |
|     -XX:+PrintReferenceGC      |               打印GC过程中弱引用和软引用的信息               | 如果程序中大量使用了这种引用，开启这个标志可以了解它们对GC开销的影响 |      |
|   -XX:+UseGCLogFileRotation    |                 GC日志循环功能以节省文件空间                 | 在长期持续运行的生产环境中，GC日志会消耗大量的磁盘空间。在这种情况下，你可能希望开启该标志 |      |
|    -XX:NumberOfGCLogFiles=N    |   GC日志文件循环时，你可以使用该标志设定保留多少个日志文件   | 在长期持续运行的生产环境中，GC日志会消耗大量的磁盘空间。在这种情况下，你可能希望开启该标志 |      |
|      -XX:GCLogFileSize=N       | 日志循环时，利用该标志可以设定日志循环之前每个日志文件的大小 | 需要长期持续运行的生产环境中GC日志会消耗大量的磁盘空间，这种情况你可能希望开启该标志 |      |
|   -XX:+UseAdaptiveSizePolicy   |              JVM根据设定的目标自适应调整堆大小               |            如果不需要手动调整堆大小，开启这个标志            |      |
|  -XX:+PrintAdaptiveSizePolicy  |               GC日志中输出代大小调整的详细信息               | 通过该标志我们可以了解JVM是如何工作的。使用G1收集器时，通过该标志的输出可以了解Full GC是否源于巨型对象的分配 |      |
| -XX:+PrintTenuringDistribution |                 在GC日志中输出对象保持的信息                 | 通过对象保持的信息我们可以判断是否需要调整对象保持的标志，以及如何调整这些标志 |      |
|   -XX:InitialSurvivorRatio=N   |             设置新生代中预留给Survivor空间的大小             | 如果“短寿”（short-lived）对象频繁地晋升到老年代，你可能需要考虑增大这个值 |      |
|     -XX:MinSurvivorRatio=N     |       设置新生代空间中用于自适应调整的Survivor空间大小       |       减小这个值会减小Survivor空间的最大值（反之亦然）       |      |
|   -XX:TargetSurvivorRatio=N    |             JVM试图在Survivor空间保留的空闲空间              |        增大这个值会缩减Survivor空间的大小（反之亦然）        |      |
| -XX:InitialTenuringThreshold=N | VM试图在Survivor空间保持对象的GC周期数，该参数设置的是一个初始值 | 增大这个值可以让对象在Survivor空间停留更长的时间，不过，需要注意的是，JVM也会对该参数进行调节 |      |
|   -XX:MaxTenuringThreshold=N   |    设置JVM可以将一个对象保持在Survivor空间的最大GC周期数     | 增大这个值可以让对象在Survivor空间停留更长时间；JVM会依据这个设定值与初始阈值，对实际的晋升阈值进行调整 |      |
|                                |                                                              |                                                              |      |



#### Throughput收集器参数标志

|          标志          |                             功能                             |                           使用场景                           |
| :--------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
| -XX:MaxGCPauseMillis=N | 为Throughput收集器设定最长停顿时间，堆的大小会依据该目标动态调整 | 通常作为Throughput收集器调优的第一步，如果Throughput收集器计算出的默认堆大小无法达到应用的目标就会对其进行调整 |
|   -XX:GCTimeRatio=N    | 用于控制Throughput收集器在垃圾收集上花费多少时间（时间比例），堆的大小会依据该目标动态调整 | 通常作为Throughput收集器调优的第一步，Throughput收集器计算出的默认堆大小如果无法达到应用的目标就会对其进行调整 |
|  -XX:-AggressiveHeap   | 对于配置了大量内存的机器，如果只运行单一的虚拟机，并为该虚拟机分配了大容量的堆，使用该标志可以开启一系列的优化标志 | 不推荐使用该标志，理想的情况是尽可能地按照需要使用具体的调优标志 |
|                        |                                                              |                                                              |



#### CMS收集器参数标志

|                 标志                 |                     功能                      |                         使用场景                          |
| :----------------------------------: | :-------------------------------------------: | :-------------------------------------------------------: |
| -XX:CMSInitiatingOccupancyFraction=N | 设定何时CMS收集器可以开启老年代空间的后台扫描 | 如果CMS收集器发生并发模式失效，则应该适当减少此参数的数值 |
|  -XX:+UseCMSInitiatingOccupancyOnly  |                                               |                                                           |
|                                      |                                               |                                                           |
|                                      |                                               |                                                           |
|                                      |                                               |                                                           |
|                                      |                                               |                                                           |
|                                      |                                               |                                                           |
|                                      |                                               |                                                           |
|                                      |                                               |                                                           |
|                                      |                                               |                                                           |
|                                      |                                               |                                                           |

